{"version":3,"sources":["./src/app/pages/users/users.module.ts","./src/app/pages/users/users.component.ts","./src/app/pages/users/users-routing.module.ts","./src/app/pages/users/user/user.component.ts","./src/app/pages/users/user/user.component.html"],"names":[],"mappings":"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","file":"users-users-module-es2015.js","sourcesContent":["/*\r\n * Copyright (c) Akveo 2019. All Rights Reserved.\r\n * Licensed under the Single Application / Multi Application License.\r\n * See LICENSE_SINGLE_APP / LICENSE_MULTI_APP in the 'docs' folder for license information on type of purchased license.\r\n */\r\n\r\nimport { NgModule } from '@angular/core';\r\nimport { ReactiveFormsModule } from '@angular/forms';\r\nimport { Ng2SmartTableModule } from 'ng2-smart-table';\r\n\r\nimport { ThemeModule } from '../../@theme/theme.module';\r\nimport { UsersRoutingModule } from './users-routing.module';\r\nimport { AuthModule } from '../../@auth/auth.module';\r\n\r\n// components\r\nimport { UsersComponent } from './users.component';\r\nimport { UserComponent } from './user/user.component';\r\nimport { ComponentsModule } from '../../@components/components.module';\r\n// components\r\n\r\nimport {\r\n  NbActionsModule,\r\n  NbButtonModule,\r\n  NbCardModule,\r\n  NbInputModule,\r\n  NbTabsetModule,\r\n  NbUserModule,\r\n  NbRadioModule,\r\n  NbSelectModule,\r\n  NbListModule,\r\n  NbIconModule,\r\n  NbSpinnerModule,\r\n  NbDatepickerModule,\r\n} from '@nebular/theme';\r\n\r\nconst  NB_MODULES = [\r\n  NbActionsModule,\r\n  NbButtonModule,\r\n  NbCardModule,\r\n  NbInputModule,\r\n  NbTabsetModule,\r\n  NbUserModule,\r\n  NbRadioModule,\r\n  NbSelectModule,\r\n  NbListModule,\r\n  NbIconModule,\r\n  NbSpinnerModule,\r\n  NbDatepickerModule,\r\n  NbInputModule,\r\n];\r\n\r\n@NgModule({\r\n  imports: [\r\n    ThemeModule,\r\n    AuthModule,\r\n    Ng2SmartTableModule,\r\n    UsersRoutingModule,\r\n    ComponentsModule,\r\n    ReactiveFormsModule,\r\n    ...NB_MODULES,\r\n  ],\r\n  declarations: [\r\n    UsersComponent,\r\n    UserComponent,\r\n  ],\r\n  entryComponents: [\r\n  ],\r\n  providers: [],\r\n})\r\nexport class UsersModule { }\r\n","/*\r\n * Copyright (c) Akveo 2019. All Rights Reserved.\r\n * Licensed under the Single Application / Multi Application License.\r\n * See LICENSE_SINGLE_APP / LICENSE_MULTI_APP in the 'docs' folder for license information on type of purchased license.\r\n */\r\n\r\nimport { Component } from '@angular/core';\r\n\r\n\r\n@Component({\r\n  selector: 'ngx-users',\r\n  template: `\r\n    <router-outlet></router-outlet>\r\n  `,\r\n})\r\nexport class UsersComponent {\r\n\r\n}\r\n","/*\r\n * Copyright (c) Akveo 2019. All Rights Reserved.\r\n * Licensed under the Single Application / Multi Application License.\r\n * See LICENSE_SINGLE_APP / LICENSE_MULTI_APP in the 'docs' folder for license information on type of purchased license.\r\n */\r\n\r\nimport { NgModule } from '@angular/core';\r\nimport { Routes, RouterModule } from '@angular/router';\r\n\r\nimport { UsersComponent } from './users.component';\r\nimport { UserComponent } from './user/user.component';\r\nimport { AdminGuard } from '../../@auth/admin.guard';\r\n\r\nconst routes: Routes = [{\r\n  path: '',\r\n  component: UsersComponent,\r\n  children: [\r\n    {\r\n      path: 'edit/:id',\r\n      canActivate: [AdminGuard],\r\n      component: UserComponent,\r\n    },\r\n    {\r\n      path: 'current',\r\n      component: UserComponent,\r\n    },\r\n    {\r\n      path: 'add',\r\n      canActivate: [AdminGuard],\r\n      component: UserComponent,\r\n    },\r\n  ],\r\n}];\r\n\r\n@NgModule({\r\n  imports: [RouterModule.forChild(routes)],\r\n  exports: [RouterModule],\r\n})\r\nexport class UsersRoutingModule {\r\n\r\n}\r\n","/*\r\n * Copyright (c) Akveo 2019. All Rights Reserved.\r\n * Licensed under the Single Application / Multi Application License.\r\n * See LICENSE_SINGLE_APP / LICENSE_MULTI_APP in the 'docs' folder for license information on type of purchased license.\r\n */\r\n\r\nimport {Component, OnDestroy, OnInit} from '@angular/core';\r\nimport {FormBuilder, FormGroup, Validators} from '@angular/forms';\r\nimport {ActivatedRoute, Router} from '@angular/router';\r\n\r\nimport {Observable,Subject} from 'rxjs';\r\n\r\nimport {NbToastrService} from '@nebular/theme';\r\n\r\nimport {User, UserData} from '../../../@core/interfaces/common/users';\r\nimport {EMAIL_PATTERN} from '../../../@auth/components';\r\nimport {NbAuthOAuth2JWTToken, NbTokenService} from '@nebular/auth';\r\nimport {UserStore} from '../../../@core/stores/user.store';\r\nimport {takeUntil} from \"rxjs/operators\";\r\n\r\nexport enum UserFormMode {\r\n  VIEW = 'View',\r\n  EDIT = 'Edit',\r\n  ADD = 'Add',\r\n  EDIT_SELF = 'EditSelf',\r\n}\r\n\r\n@Component({\r\n  selector: 'ngx-user',\r\n  templateUrl: './user.component.html',\r\n  styleUrls: ['./user.component.scss'],\r\n})\r\nexport class UserComponent implements OnInit, OnDestroy {\r\n  userForm: FormGroup;\r\n  // companyId: any;\r\n\r\n  protected readonly unsubscribe$ = new Subject<void>();\r\n\r\n  get firstName() { return this.userForm.get('name'); }\r\n\r\n  get lastName() { return this.userForm.get('lastName'); }\r\n\r\n  get login() { return this.userForm.get('login'); }\r\n\r\n  get email() { return this.userForm.get('email'); }\r\n\r\n  mode: UserFormMode;\r\n  setViewMode(viewMode: UserFormMode) {\r\n    this.mode = viewMode;\r\n  }\r\n\r\n  constructor(private usersService: UserData,\r\n              private router: Router,\r\n              private route: ActivatedRoute,\r\n              private tokenService: NbTokenService,\r\n              private userStore: UserStore,\r\n              private toasterService: NbToastrService,\r\n              private fb: FormBuilder) {\r\n  }\r\n\r\n  ngOnInit(): void {\r\n    this.initUserForm();\r\n    this.loadUserData();\r\n  }\r\n\r\n  initUserForm() {\r\n    this.userForm = this.fb.group({\r\n      id: this.fb.control(''),\r\n      role: this.fb.control(''),\r\n      name: this.fb.control('', [Validators.minLength(3), Validators.maxLength(20)]),\r\n      lastName: this.fb.control('', [Validators.minLength(3), Validators.maxLength(20)]),\r\n      login: this.fb.control(''),\r\n      age: this.fb.control(''),\r\n      companyId: this.fb.control(''),\r\n      email: this.fb.control('', [\r\n        Validators.required,\r\n        Validators.pattern(EMAIL_PATTERN),\r\n      ]),\r\n    });\r\n  }\r\n\r\n  get canEdit(): boolean {\r\n    return this.mode !== UserFormMode.VIEW;\r\n  }\r\n\r\n\r\n  loadUserData() {\r\n    const id = this.route.snapshot.paramMap.get('id');\r\n    const isProfile = this.route.snapshot.queryParamMap.get('profile');\r\n    if (isProfile) {\r\n      this.setViewMode(UserFormMode.EDIT_SELF);\r\n      this.loadUser();\r\n    } else {\r\n      if (id) {\r\n        const currentUserId = this.userStore.getUser().id;\r\n        this.setViewMode(currentUserId.toString() === id ? UserFormMode.EDIT_SELF : UserFormMode.EDIT);\r\n        this.loadUser(id);\r\n      } else {\r\n        this.setViewMode(UserFormMode.ADD);\r\n      }\r\n    }\r\n  }\r\n\r\n  loadUser(id?) {\r\n    const loadUser = this.mode === UserFormMode.EDIT_SELF\r\n      ? this.usersService.getCurrentUser() : this.usersService.get(id);\r\n    loadUser\r\n      .pipe(takeUntil(this.unsubscribe$))\r\n      .subscribe((user) => {\r\n        this.userForm.setValue({\r\n          id: user.id ? user.id : '',\r\n          role: user.role ? user.role : '',\r\n          name: user.name ? user.name : '',\r\n          lastName: user.lastName ? user.lastName : '',\r\n          login: user.login ? user.login : '',\r\n          age: '',\r\n          companyId: user.companyId ? user.companyId : '',\r\n          email: user.email,\r\n        });\r\n        // this.companyId = user.companyId;\r\n        // this is a place for value changes handling\r\n        // this.userForm.valueChanges.pipe(takeUntil(this.unsubscribe$)).subscribe((value) => {   });\r\n      });\r\n  }\r\n\r\n\r\n  convertToUser(value: any): User {\r\n    const user: User = value;\r\n    return user;\r\n  }\r\n\r\n  save() {\r\n    const user: User = this.convertToUser(this.userForm.value);   \r\n    let observable = new Observable<User>();\r\n    if (this.mode === UserFormMode.EDIT_SELF) {\r\n      this.usersService.updateCurrent(user).subscribe((result: any) => {\r\n          this.tokenService.set(new NbAuthOAuth2JWTToken(result, 'email', new Date()));\r\n          this.handleSuccessResponse();\r\n        },\r\n        err => {\r\n          this.handleWrongResponse();\r\n        });\r\n    } else {\r\n      observable = user.id\r\n        ? this.usersService.update(user)\r\n        : this.usersService.create(user);\r\n    }\r\n\r\n    observable\r\n      .pipe(takeUntil(this.unsubscribe$))\r\n      .subscribe(() => {\r\n          this.handleSuccessResponse();\r\n        },\r\n        err => {\r\n          this.handleWrongResponse();\r\n        });\r\n  }\r\n\r\n  handleSuccessResponse() {\r\n    this.toasterService.success('', `Item ${this.mode === UserFormMode.ADD ? 'created' : 'updated'}!`);\r\n    this.back();\r\n  }\r\n\r\n  handleWrongResponse() {\r\n    this.toasterService.danger('', `This email has already taken!`);\r\n  }\r\n\r\n  back() {\r\n    this.router.navigate(['/pages']);\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    this.unsubscribe$.next();\r\n    this.unsubscribe$.complete();\r\n  }\r\n}\r\n","<!--\r\n  ~ Copyright (c) Akveo 2019. All Rights Reserved.\r\n  ~ Licensed under the Single Application / Multi Application License.\r\n  ~ See LICENSE_SINGLE_APP / LICENSE_MULTI_APP in the 'docs' folder for license information on type of purchased license.\r\n  -->\r\n\r\n<nb-card>\r\n  <nb-card-header>{{ mode }} user</nb-card-header>\r\n  <nb-card-body>\r\n    <div [formGroup]=\"userForm\" class=\"container\">\r\n      <div class=\"form-group\">\r\n        <label for=\"firstName\">First Name</label>\r\n        <input\r\n          nbInput\r\n          id=\"firstName\"\r\n          formControlName=\"name\"\r\n          [status]=\"\r\n            firstName?.hasError('minlength') || firstName?.hasError('maxlength')\r\n              ? 'danger'\r\n              : 'primary'\r\n          \"\r\n          class=\"form-control\"\r\n          placeholder=\"Last Name\"\r\n        />\r\n        <ngx-validation-message\r\n          label=\"First Name\"\r\n          [showMinLength]=\"firstName?.hasError('minlength')\"\r\n          [showMaxLength]=\"firstName?.hasError('maxlength')\"\r\n          minLength=\"3\"\r\n          maxLength=\"20\"\r\n        ></ngx-validation-message>\r\n      </div>\r\n\r\n      <div class=\"form-group\">\r\n        <label for=\"lastName\">Last Name</label>\r\n        <input\r\n          nbInput\r\n          id=\"lastName\"\r\n          formControlName=\"lastName\"\r\n          [status]=\"\r\n            lastName?.hasError('minlength') || lastName?.hasError('maxlength')\r\n              ? 'danger'\r\n              : 'primary'\r\n          \"\r\n          class=\"form-control\"\r\n          placeholder=\"Last Name\"\r\n        />\r\n        <ngx-validation-message\r\n          label=\"Last Name\"\r\n          [showMinLength]=\"lastName?.hasError('minlength')\"\r\n          [showMaxLength]=\"lastName?.hasError('maxlength')\"\r\n          minLength=\"3\"\r\n          maxLength=\"20\"\r\n        ></ngx-validation-message>\r\n      </div>\r\n\r\n      <div class=\"form-group\">\r\n        <label for=\"inputLogin\">Login</label>\r\n        <input\r\n          nbInput\r\n          id=\"inputLogin\"\r\n          formControlName=\"login\"\r\n          disabled\r\n          [status]=\"\r\n            (login?.errors?.required ||\r\n              login?.hasError('minlength') ||\r\n              login?.hasError('maxlength')) &&\r\n            login.touched\r\n              ? 'danger'\r\n              : 'primary'\r\n          \"\r\n          class=\"form-control\"\r\n          placeholder=\"Login\"\r\n        />\r\n        <ngx-validation-message\r\n          label=\"Login\"\r\n          [showMinLength]=\"login?.hasError('minlength')\"\r\n          [showMaxLength]=\"login?.hasError('maxlength')\"\r\n          [showRequired]=\"login?.errors?.required && login.touched\"\r\n          minLength=\"6\"\r\n          maxLength=\"20\"\r\n        ></ngx-validation-message>\r\n      </div>\r\n\r\n      <div class=\"form-group\">\r\n        <label for=\"inputEmail\">Email</label>\r\n        <input\r\n          nbInput\r\n          id=\"inputEmail\"\r\n          formControlName=\"email\"\r\n          [status]=\"\r\n            (email?.errors?.required || email?.hasError('pattern')) &&\r\n            email.touched\r\n              ? 'danger'\r\n              : 'primary'\r\n          \"\r\n          class=\"form-control\"\r\n          placeholder=\"Email\"\r\n        />\r\n        <ngx-validation-message\r\n          label=\"Email\"\r\n          [showPattern]=\"email?.hasError('pattern') && email.touched\"\r\n          [showRequired]=\"email?.errors?.required && email.touched\"\r\n          min=\"1\"\r\n          max=\"120\"\r\n        ></ngx-validation-message>\r\n      </div>\r\n      \r\n    </div>\r\n  </nb-card-body>\r\n  <nb-card-footer>\r\n    <button\r\n      nbButton\r\n      status=\"primary\"\r\n      [disabled]=\"!userForm.valid\"\r\n      (click)=\"save()\"\r\n      hero\r\n    >\r\n      Submit\r\n    </button>\r\n    <button nbButton status=\"info\" (click)=\"back()\" hero>Back</button>\r\n  </nb-card-footer>\r\n</nb-card>\r\n"],"sourceRoot":"webpack:///"}